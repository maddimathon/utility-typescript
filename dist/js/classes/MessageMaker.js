import {AbstractConfigurableClass as A} from'./abstracts/AbstractConfigurableClass.js';import {mergeArgs as b,softWrapText as c,timestamp as d} from'../functions/index.js';var e=a=>typeof a==='string';var g=a=>typeof a==='function',{isArray:f}=Array;export class MessageMaker extends A{static defaultPainter(_){switch(_.paintFormat) {case 'html':return (B,C={})=>{if(!C.bold&&!C.clr&&!C.flag&&!C.italic)return B;C.italic&&(B=`<em>${B}</em>`);C.bold&&(B=`<strong>${B}</strong>`);return B};case 'markdown':return (D,_B={})=>{if(!_B.bold&&!_B.clr&&!_B.flag&&!_B.italic)return D;_B.italic&&(D=`_${D}_`);_B.bold&&(D=`**${D}**`);return D};case 'node':return (_A,E={})=>{var _C,_d;if(!E.bold&&!E.clr&&!E.flag&&!E.italic)return _A;var _e=[];if(E.clr||E.flag){var F=process.stdout.getColorDepth();let aA;let aB;switch(F) {case 4:var G=_.ansiColours[4];var h=(_C=E.clr)!==null&&_C!==void 0?_C:'black';aA=null;aB=h;E.flag&&(aA=h,aB=null);(aA||aB!=='black')&&_e.push([aB?G.fg[aB]:'',aA?G.bg[aA]:''].filter(s=>s).join(';'));break;case 8:case 24:var i=_.ansiColours[F];var j=(_d=E.clr)!==null&&_d!==void 0?_d:'black';aA=null;aB=j;E.flag&&(aA=j,aB='white');if(aA)if(F==8)switch(aA) {case 'orange':case 'pink':case 'turquoise':case 'yellow':aB='black';break;default:aB='white';break}else aA==='yellow'&&(aB='black');if(aA||aB!=='black'){var k=[`38;${i[aB]}`];aA&&k.push(`48;${i[aA]}`);_e.push(k.join(';'))}break}}E.bold&&_e.push('1');E.italic&&_e.push('3');return '\x1b['+_e.join(';')+'m'+_A+'\x1b[0m'}}return null}get ARGS_DEFAULT(){return{ansiColours:{4:{fg:{black:'30',grey:'37',white:'37',red:'31',orange:'33',yellow:'33',green:'32',turquoise:'36',blue:'34',purple:'35',pink:'35'},bg:{black:'40',grey:'40',white:'47',red:'41',orange:'43',yellow:'43',green:'42',turquoise:'46',blue:'44',purple:'45',pink:'45'}},8:{black:'5;232',grey:'5;243',white:'5;255',red:'5;124',orange:'5;166',yellow:'5;215',green:'5;28',turquoise:'5;37',blue:'5;20',purple:'5;55',pink:'5;212'},24:{black:'2;26;26;26',grey:'2;105;105;105',white:'2;248;248;248',red:'2;168;36;36',orange:'2;174;84;4',yellow:'2;204;182;0',green:'2;24;118;10',turquoise:'2;0;128;98',blue:'2;60;84;157',purple:'2;129;75;155',pink:'2;179;77;145'}},msg:{bold:!1,clr:null,depth:0,flag:!1,fullWidth:!1,hangingIndent:'',indent:'',italic:!1,linesIn:0,linesOut:1,minWidth:20,maxWidth:null,tab:'    '},optsRecursive:!0,painter:null,paintFormat:null,paintIfEmpty:!1}}buildArgs(aC){var aD=A.abstractArgs(this.ARGS_DEFAULT),aE=b(aD,aC,this.ARGS_DEFAULT.optsRecursive);if((aC===null||aC===void 0?void 0:aC.msg)&&!g(aC.msg)){!g(aD.msg)&&(aE.msg=b(aD.msg,aC.msg,!0));aC.msg.minWidth&&(aE.msg.minWidth=Math.max(10,aC.msg.minWidth))}(!aE.painter&&aE.paintFormat)&&(aE.painter=MessageMaker.defaultPainter(aE));return aE}msgArgs(aF){var aG,aH,_D;var _E=b(this.args.msg,aF,!0);if(_E.maxWidth!==null){var _f=_E.maxWidth-(((aH=(aG=aF===null||aF===void 0?void 0:aF.tab)===null||aG===void 0?void 0:aG.length)!==null&&aH!==void 0?aH:0)*((_D=aF===null||aF===void 0?void 0:aF.depth)!==null&&_D!==void 0?_D:0));_E.maxWidth=Math.max(10,_E.minWidth,_f);_E.flag&&(_E.maxWidth=_E.maxWidth-2)}return _E}constructor(aI={}){super(aI)}lineMapper(aJ,aK,aL=''){if(aK.maxWidth&&aK.fullWidth)aJ.length<aK.maxWidth&&(aJ=aJ+' '.repeat(aK.maxWidth-aJ.length));(aK.flag&&this.args.paintFormat==='node')&&(aJ=` ${aJ} `);return aK.tab.repeat(aK.depth)+aK.indent+aL+this.painter(aJ,aK)}msg(aM,aN={}){var aO,aP;var aQ=this.msgArgs(aN);f(aM)&&(aM=aM.join('\n'));aQ.maxWidth&&(aM=c(aM,aQ.maxWidth));var _F=aM.split(/\n/g);return ('\n'.repeat((aO=aQ.linesIn)!==null&&aO!==void 0?aO:0)+_F.map((aR,aS)=>this.lineMapper(aR,aQ,aS>0?aQ.hangingIndent:'')).join('\n')+'\n'.repeat((aP=aQ.linesOut)!==null&&aP!==void 0?aP:0))}msgs(aT,aU={}){var aV,aW,aX;!f(aT)&&(aT=[aT]);var aY={...aU,linesIn:0,linesOut:0},_g=[];aT.forEach(([aZ,bA],bB)=>{var bC;bA=this.mergeArgs(aY,bA,!0);if(bB>0&&aU.hangingIndent){var bD=(bC=aU.hangingIndent)!==null&&bC!==void 0?bC:this.ARGS_DEFAULT.msg.hangingIndent;bA={...bA,hangingIndent:'',indent:bD}}_g.push(this.msg(aZ,bA))});return ('\n'.repeat((aV=aU.linesIn)!==null&&aV!==void 0?aV:0)+_g.join((aW=aU.joiner)!==null&&aW!==void 0?aW:'\n\n')+'\n'.repeat((aX=aU.linesOut)!==null&&aX!==void 0?aX:0))}painter(bE,bF={}){if(!this.args.paintIfEmpty)if(!bE.replace(/\s+/gs,'').length)return bE;this.args.painter&&(bE=this.args.painter(bE,bF));return bE}timestampMsg(bG,bH={},bI={}){var bJ,bK;let bL=this.msgArgs({joiner:'\n\n',...bH});e(bG)?(bG=bG?[[bG]]:[],bL.joiner=(bJ=bL.joiner)!==null&&bJ!==void 0?bJ:'\n'):(bG=bG.map(m=>{var bM;if(e(m)){bL.joiner=(bM=bL.joiner)!==null&&bM!==void 0?bM:'\n';return[m]}return m}));var _G=bG,H=d((bK=bI.date)!==null&&bK!==void 0?bK:null,{date:!1,time:!0,...bI.stamp}),I=bL.depth,J=bL.linesIn,K=bL.linesOut;var l=`[${H}]`;bL={...bL,depth:0,linesIn:0,linesOut:0,hangingIndent:bL.hangingIndent+' '.repeat(l.length+1)+bL.tab.repeat(I)};return ('\n'.repeat(J!==null&&J!==void 0?J:0)+this.msg(l,this.mergeArgs(bL,{flag:!1,italic:!1,...bI,depth:I,linesIn:0,linesOut:0},!0))+(_G.length?((bL.flag?this.msg(' ',bL):' ')+this.msgs(_G,bL)):'')+'\n'.repeat(K!==null&&K!==void 0?K:0))}}