import {AbstractConfigurableClass as A} from'./abstracts/AbstractConfigurableClass.js';import {mergeArgs as b,softWrapText as c,timestamp as d} from'../functions/index.js';var e=a=>typeof a==='string';var g=a=>typeof a==='function',{isArray:f}=Array;export class MessageMaker extends A{static defaultPainter(_){switch(_.paintFormat) {case 'html':return (B,C={})=>{if(!C.bold&&!C.clr&&!C.flag&&!C.italic)return B;C.italic&&(B=`<em>${B}</em>`);C.bold&&(B=`<strong>${B}</strong>`);return B};case 'markdown':return (D,_B={})=>{if(!_B.bold&&!_B.clr&&!_B.flag&&!_B.italic)return D;_B.italic&&(D=`_${D}_`);_B.bold&&(D=`**${D}**`);return D};case 'node':return (_A,E={})=>{var _C,_d;if(!E.bold&&!E.clr&&!E.flag&&!E.italic)return _A;var _e=[];if(E.clr||E.flag){var F=process.stdout.getColorDepth();let _a=null;let _b=(_C=E.clr)!==null&&_C!==void 0?_C:'black';if(E.flag)if(E.flag=='reverse'&&F>4){switch(_b) {case 'grey':_a='light-grey';_b='black';break;default:_a='light-grey';break}if(F===8)switch(_b) {case 'orange':case 'pink':_a='grey';break}}else{_a=(_d=E.clr)!==null&&_d!==void 0?_d:'black';_b=F>4?'white':null}switch(F) {case 4:(_a||_b!=='black')&&_e.push([_b?_.ansiColours[4].fg[_b]:'',_a?_.ansiColours[4].bg[_a]:''].filter(s=>s).join(';'));break;case 8:case 24:if(_a&&E.flag!=='reverse')if(F==8)switch(_a) {case 'light-grey':case 'orange':case 'yellow':_b='black';break;default:_b='white';break}else switch(_a) {case 'grey':case 'yellow':_b='black';break;default:_b='white';break}(_a||_b!=='black')&&(_b&&_e.push(`38;${_.ansiColours[F][_b]}`),_a&&_e.push(`48;${_.ansiColours[F][_a]}`));break}}E.bold&&_e.push('1');E.italic&&_e.push('3');return '\x1b['+_e.join(';')+'m'+_A+'\x1b[0m'}}return null}get ARGS_DEFAULT(){return{ansiColours:{4:{fg:{black:'30',grey:'30','light-grey':'37',white:'37',red:'31',orange:'33',yellow:'33',green:'32',turquoise:'36',blue:'34',purple:'35',pink:'35'},bg:{black:'40',grey:'40','light-grey':'47',white:'47',red:'41',orange:'43',yellow:'43',green:'42',turquoise:'46',blue:'44',purple:'45',pink:'45'}},8:{black:'5;232',grey:'5;241','light-grey':'5;247',white:'5;255',red:'5;124',orange:'5;166',yellow:'5;208',green:'5;28',turquoise:'5;30',blue:'5;20',purple:'5;55',pink:'5;162'},24:{black:'2;26;26;26',grey:'2;108;108;108','light-grey':'2;208;208;208',white:'2;248;248;248',red:'2;168;36;36',orange:'2;174;84;4',yellow:'2;204;182;0',green:'2;24;118;10',turquoise:'2;0;128;98',blue:'2;60;84;157',purple:'2;129;75;155',pink:'2;179;77;145'}},msg:{bold:!1,clr:null,depth:0,flag:!1,fullWidth:!1,hangingIndent:'',indent:'',italic:!1,linesIn:0,linesOut:1,minWidth:20,maxWidth:null,tab:'    '},optsRecursive:!0,painter:null,paintFormat:null,paintIfEmpty:!1}}buildArgs(bO){var bP=A.abstractArgs(this.ARGS_DEFAULT),_c=b(bP,bO,this.ARGS_DEFAULT.optsRecursive);((bO===null||bO===void 0?void 0:bO.msg)&&!g(bO.msg))&&(!g(bP.msg)&&(_c.msg=b(bP.msg,bO.msg,!0)),bO.msg.minWidth&&(_c.msg.minWidth=Math.max(10,bO.msg.minWidth)));(!_c.painter&&_c.paintFormat)&&(_c.painter=MessageMaker.defaultPainter(_c));return _c}msgArgs(aF){var aG,aH,_D;var _E=b(this.args.msg,aF,!0);if(_E.maxWidth!==null){var _f=_E.maxWidth-(((aH=(aG=aF===null||aF===void 0?void 0:aF.tab)===null||aG===void 0?void 0:aG.length)!==null&&aH!==void 0?aH:0)*((_D=aF===null||aF===void 0?void 0:aF.depth)!==null&&_D!==void 0?_D:0));_E.maxWidth=Math.max(10,_E.minWidth,_f);_E.flag&&(_E.maxWidth=_E.maxWidth-2)}return _E}constructor(aI={}){super(aI)}lineMapper(aJ,aK,aL=''){(aK.maxWidth&&aK.fullWidth)&&aJ.length<aK.maxWidth&&(aJ=aJ+' '.repeat(aK.maxWidth-aJ.length));(aK.flag&&this.args.paintFormat==='node')&&(aJ=` ${aJ} `);return aK.tab.repeat(aK.depth)+aK.indent+aL+this.painter(aJ,aK)}msg(aM,aN={}){var aO,aP;var aQ=this.msgArgs(aN);f(aM)&&(aM=aM.join('\n'));aQ.maxWidth&&(aM=c(aM,aQ.maxWidth));var _F=aM.split(/\n/g);return ('\n'.repeat((aO=aQ.linesIn)!==null&&aO!==void 0?aO:0)+_F.map((aR,aS)=>this.lineMapper(aR,aQ,aS>0?aQ.hangingIndent:'')).join('\n')+'\n'.repeat((aP=aQ.linesOut)!==null&&aP!==void 0?aP:0))}msgs(aT,aU={}){var aV,aW,aX;!f(aT)&&(aT=[aT]);var aY={...aU,linesIn:0, linesOut:0},G=[];for(const[bB,[aZ,bA]] of aT.entries()){var bC,bD;bA=this.mergeArgs(aY,bA,!0);if(bB>0&&aU.hangingIndent&&((bC=aY.joiner)===null||bC===void 0?void 0:bC.match(/\n/g))){var bE=(bD=aU.hangingIndent)!==null&&bD!==void 0?bD:this.ARGS_DEFAULT.msg.hangingIndent;bA={...bA,hangingIndent:'', indent:bE}}G.push(this.msg(aZ,bA))}return ('\n'.repeat((aV=aU.linesIn)!==null&&aV!==void 0?aV:0)+G.join((aW=aU.joiner)!==null&&aW!==void 0?aW:'\n\n')+'\n'.repeat((aX=aU.linesOut)!==null&&aX!==void 0?aX:0))}painter(bF,bG={}){if(!this.args.paintIfEmpty)if(!bF.replace(/\s+/gs,'').length)return bF;this.args.painter&&(bF=this.args.painter(bF,bG));return bF}timestampMsg(bH,bI={},bJ={}){var bK,bL;let bM=this.msgArgs({joiner:'\n\n',...bI});e(bH)?(bH=bH?[[bH]]:[],bM.joiner=(bK=bM.joiner)!==null&&bK!==void 0?bK:'\n'):bH=bH.map(m=>{var bN;if(e(m)){bM.joiner=(bN=bM.joiner)!==null&&bN!==void 0?bN:'\n';return[m]}return m});var _g=bH,h=d((bL=bJ.date)!==null&&bL!==void 0?bL:null,{date:!1,time:!0,...bJ.stamp}),i=bM.depth,j=bM.linesIn,k=bM.linesOut;var l=`[${h}]`;bM={...bM,depth:0, linesIn:0, linesOut:0, hangingIndent:bM.hangingIndent+' '.repeat(l.length+1)+bM.tab.repeat(i)};return ('\n'.repeat(j!==null&&j!==void 0?j:0)+this.msg(l,this.mergeArgs(bM,{flag:!1, italic:!1, ...bJ,depth:i, linesIn:0, linesOut:0},!0))+(_g.length?((bM.flag?this.msg(' ',bM):' ')+this.msgs(_g,bM)):'')+'\n'.repeat(k!==null&&k!==void 0?k:0))}}