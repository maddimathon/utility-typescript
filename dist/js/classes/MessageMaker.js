import {AbstractConfigurableClass as A} from'./abstracts/AbstractConfigurableClass.js';import {mergeArgs as b,timestamp as c} from'../functions/index.js';var d=a=>typeof a==='string';var f=a=>typeof a==='function',{isArray:e}=Array;export class MessageMaker extends A{static defaultPainter(_){switch(_.paintFormat) {case 'html':return (B,C={})=>{if(!C.bold&&!C.clr&&!C.flag&&!C.italic)return B;C.italic&&(B=`<em>${B}</em>`);C.bold&&(B=`<strong>${B}</strong>`);return B};case 'markdown':return (D,_B={})=>{if(!_B.bold&&!_B.clr&&!_B.flag&&!_B.italic)return D;_B.italic&&(D=`_${D}_`);_B.bold&&(D=`**${D}**`);return D};case 'node':return (_A,E={})=>{var _C,_d;if(!E.bold&&!E.clr&&!E.flag&&!E.italic)return _A;var _e=[];if(E.clr||E.flag){var F=process.stdout.getColorDepth();let aA;let aB;switch(F) {case 4:var g=_.ansiColours[4];var h=(_C=E.clr)!==null&&_C!==void 0?_C:'black';aA=null;aB=h;E.flag&&(aA=h,aB=null);(aA||aB!=='black')&&_e.push([aB?g.fg[aB]:'',aA?g.bg[aA]:''].filter(s=>s).join(';'));break;case 8:case 24:var i=_.ansiColours[F];var j=(_d=E.clr)!==null&&_d!==void 0?_d:'black';aA=null;aB=j;E.flag&&(aA=j,aB='white');if(aA)if(F==8)switch(aA) {case 'orange':case 'pink':case 'turquoise':case 'yellow':aB='black';break;default:aB='white';break}else aA==='yellow'&&(aB='black');if(aA||aB!=='black'){var k=[`38;${i[aB]}`];aA&&k.push(`48;${i[aA]}`);_e.push(k.join(';'))}break}}E.bold&&_e.push('1');E.italic&&_e.push('3');return '\x1b['+_e.join(';')+'m'+_A+'\x1b[0m'}}return null}get ARGS_DEFAULT(){return{ansiColours:{4:{fg:{black:'30',grey:'37',white:'37',red:'31',orange:'33',yellow:'33',green:'32',turquoise:'36',blue:'34',purple:'35',pink:'35'},bg:{black:'40',grey:'40',white:'47',red:'41',orange:'43',yellow:'43',green:'42',turquoise:'46',blue:'44',purple:'45',pink:'45'}},8:{black:'5;232',grey:'5;243',white:'5;255',red:'5;124',orange:'5;166',yellow:'5;215',green:'5;28',turquoise:'5;37',blue:'5;20',purple:'5;55',pink:'5;212'},24:{black:'2;26;26;26',grey:'2;105;105;105',white:'2;248;248;248',red:'2;168;36;36',orange:'2;174;84;4',yellow:'2;204;182;0',green:'2;24;118;10',turquoise:'2;0;128;98',blue:'2;60;84;157',purple:'2;129;75;155',pink:'2;179;77;145'}},msg:{bold:!1,clr:null,depth:0,flag:!1,fullWidth:!1,hangingIndent:'',indent:'',italic:!1,linesIn:0,linesOut:1,minWidth:20,maxWidth:null,tab:'    '},optsRecursive:!0,painter:null,paintFormat:null,paintIfEmpty:!1}}buildArgs(aC){var aD=A.abstractArgs(this.ARGS_DEFAULT),aE=b(aD,aC,this.ARGS_DEFAULT.optsRecursive);if((aC===null||aC===void 0?void 0:aC.msg)&&!f(aC.msg)){!f(aD.msg)&&(aE.msg=b(aD.msg,aC.msg,!0));aC.msg.minWidth&&(aE.msg.minWidth=Math.max(10,aC.msg.minWidth))}(!aE.painter&&aE.paintFormat)&&(aE.painter=MessageMaker.defaultPainter(aE));return aE}msgArgs(aF){var aG=b(this.args.msg,aF,!0);if(aG.maxWidth!==null){aG.maxWidth=Math.max(10,aG.minWidth,aG.maxWidth);aG.flag&&(aG.maxWidth=aG.maxWidth-2)}return aG}constructor(aH={}){super(aH)}lineMapper(aI,aJ,aK=''){if(aJ.maxWidth&&aJ.fullWidth)aI.length<aJ.maxWidth&&(aI=aI+' '.repeat(aJ.maxWidth-aI.length));(aJ.flag&&this.args.paintFormat==='node')&&(aI=` ${aI} `);return aJ.tab.repeat(aJ.depth)+aK+aJ.indent+this.painter(aI,aJ)}msg(aL,aM={}){var aN,_D;var _E=this.msgArgs(aM);e(aL)&&(aL=aL.join('\n'));var _f=aL.split(/\n/g);return ('\n'.repeat((aN=_E.linesIn)!==null&&aN!==void 0?aN:0)+_f.map((aO,aP)=>this.lineMapper(aO,_E,aP>0?_E.hangingIndent:'')).join('\n')+'\n'.repeat((_D=_E.linesOut)!==null&&_D!==void 0?_D:0))}msgs(aQ,aR={}){var aS,aT,aU;!e(aQ)&&(aQ=[aQ]);var _F={...aR,linesIn:0,linesOut:0},G=[];aQ.forEach(([aV,aW],aX)=>{var aY;aW=this.mergeArgs(_F,aW,!0);(aX>0&&aR.hangingIndent)&&(aW={...aW,hangingIndent:'',indent:(aY=aR.hangingIndent)!==null&&aY!==void 0?aY:this.ARGS_DEFAULT.msg.hangingIndent});G.push(this.msg(aV,aW))});return ('\n'.repeat((aS=aR.linesIn)!==null&&aS!==void 0?aS:0)+G.join((aT=aR.joiner)!==null&&aT!==void 0?aT:'\n\n')+'\n'.repeat((aU=aR.linesOut)!==null&&aU!==void 0?aU:0))}painter(aZ,bA={}){if(!this.args.paintIfEmpty)if(!aZ.replace(/\s+/gs,'').length)return aZ;this.args.painter&&(aZ=this.args.painter(aZ,bA));return aZ}timestampMsg(bB,bC={},bD={}){var bE,bF;let bG=this.msgArgs({joiner:'\n\n',...bC});d(bB)?(bB=[[bB]],bG.joiner=(bE=bG.joiner)!==null&&bE!==void 0?bE:'\n'):(bB=bB.map(m=>{var bH;if(d(m)){bG.joiner=(bH=bG.joiner)!==null&&bH!==void 0?bH:'\n';return[m]}return m}));var _g=c((bF=bD.date)!==null&&bF!==void 0?bF:null,{date:!1,time:!0,...bD.stamp}),H=bG.depth,I=bG.linesIn,J=bG.linesOut;var K=`[${_g}]`;bG={...bG,depth:0,linesIn:0,linesOut:0,hangingIndent:bG.hangingIndent+' '.repeat(K.length+1)+bG.tab.repeat(H)};return ('\n'.repeat(I!==null&&I!==void 0?I:0)+this.msg(K,this.mergeArgs(bG,{flag:!1,italic:!1,...bD,depth:H,linesIn:0,linesOut:0},!0))+(bG.flag?this.msg(' ',bG):' ')+this.msgs(bB,bG)+'\n'.repeat(J!==null&&J!==void 0?J:0))}}